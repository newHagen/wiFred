= Using the wiFred in day-to-day operations
Heiko Rosemann
include::version_en.adoc[]
:description: Usage documentation, LED patterns. charging of the wiFred
:url-repo: https://github.com/newHeiko/wiFred
:icons: image
:iconsdir: images/icons/
:imagesdir: images/
:toc:

image::2021-01-23-preview0001.jpg[wiFred with laser engraved housing]

// tag::largefile[]

[#throttle]
== Operating locos

include::leds_en.adoc[tags=largefile]

[#throttleControls]
.Controls and features of the wiFred throttle
image::DSC0690.jpg[alt="Throttle"]

<<throttleControls>> shows the controls of the wireless throttle. They consist of the following:

- Four loco selection switches (loco 1 on the left, loco 4 on the right, move towards speed potentiometer to enable)

- Speed potentiometer (Counter-clockwise endstop: Stop, clockwise endstop: Full speed)

- Direction switch - move right for forward movement, left for reverse movement

- Black function keys F0 to F8

- Yellow shift key to trigger F9-F16 and turn on flashlight function

- Red emergency stop key

- Two green direction indicator LEDs next to speed potentiometer

- Red status LED next to speed potentiometer

- Red charging indicator LED at lower end of device - lit while charging

- Green fully charged indicator LED at lower end of device - lit when fully charged as long as charger still connected

As soon as any of the loco selection switches is moved into the "enabled" position, the throttle will boot up and try to connect to a wireless network. When all four loco selection switches are "disabled", the throttle will disconnect from the wireless network after a grace period of five seconds. The device will then go into low power mode, in which the battery will last for more than a year.

If no connection to the network configured into the device can be established within 60 seconds, the throttle will create it's own wireless network named *wiFred-config* plus six hex digits taken from the MAC address of the throttle WiFi interface, for example *wiFred-config61FB7B*, to enable configuration as described in <<config>>.

Four different locos with long or short DCC addresses can be assigned to the four loco selection switches. Commands derived from the speed potentiometer, the direction switch and the function keys will be transmitted to all selected locos (near) simultaneously, with a certain translation table enabling some locos to go backwards when others go forwards and also limiting function keys to some of the four locos only - this is described in more detail in <<throttle_LocoConf>> and <<throttle_FunctionConf>>.

Pushing the red emergency stop key will cause the throttle to send an emergency stop signal to all four locos attached. After an emergency stop, turn the speed potentiometer to zero to re-enable control of the locos.

Pushing the red emergency stop key while holding down the shift key will place the device into configuration mode (as well as issueing an emergency stop to all attached locos). See <<config>> for more details on how to access the throttle to do the configuration.

Any change in the loco selection switches will cause the throttle to send an emergency stop command to all attached locos. This makes sure that any loco that is deselected will stop on the layout and avoids newly selected locos suddenly taking off at speed. The same is true for a change in the direction switch, to avoid high-speed reverse maneuvers. Turn the speed potentiometer to zero to re-enable control of the locos.

When the battery is low, the device will not re-activate before charging the batteries, but continue operating for approximately an hour if active. When the battery is empty, it will disconnect and enter low power mode. Expected runtime is around 20 hours of full time operations, more if the throttle is placed in low power mode when the locos are not running.

During startup and operation, the LEDs will show the patterns explained in <<ledTable>>. After turning off the wiFred, the LEDs will show the current battery voltage for a few seconds, as described in <<ledTableVoltage>>.

=== Charging the wiFred

The wiFred can be charged through the Micro-USB connector at the lower end of the device. Maximum charging current is approximately 300-400â€†mA and the device does not communicate with the USB host, so technically there is no guarantee that charging from a USB cable will work. Most chargers, computer ports or power banks do not check the current before powering up.

As long as the battery is being charged, the red charging indicator LED will be lit. When the battery is fully charged, the green charged indicator LED will be lit as long as the charger is still connected. Expected charging time is around five to six hours for a full charge.

Even while charging, the device can still be operated (particularly helpful with a power bank) but since the operating current will come out of the battery, the battery will never be fully charged.

If both charging status LEDs light up when a charging cable is connected, probably the internal connection to the battery is faulty.

// end::largefile[]

include::biblio_en.adoc[]